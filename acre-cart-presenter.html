<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import"
    href="../polymer/polymer.html">
<link rel="import"
    href="../iron-image/iron-image.html">
<link rel="import"
    href="../iron-icon/iron-icon.html">
<link rel="import"
    href="../iron-icons/iron-icons.html">
<link rel="import"
    href="../paper-button/paper-button.html">
<link rel="import"
    href="../iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import"
    href="../paper-badge/paper-badge.html">
<link rel="import"
    href="../paper-icon-button/paper-icon-button.html">
<link rel="import"
    href="../paper-toast/paper-toast.html">

<!--
An element providing a solution to no problem in particular.

Example:

    <acre-cart-presenter></acre-cart-presenter>

Custom property | Description | Default
----------------|-------------|----------
`--toolbar-container` | Mixin applied to all rows (middle, top, bottom)  | `{}`


@demo demo/index.html
@hero hero.svg
-->

<dom-module id="acre-cart-presenter">
  <template>
    <style include="iron-flex iron-flex-alignment" />
    <style>
      :host {
        display: block;
        box-sizing: border-box;
      }

      a,
      a:link,
      a:visited,
      a:hover,
      a:focus,
      a:active {
        color: inherit;
        text-decoration: none;
      }

      paper-button {
        --paper-button: {
          text-transform: none;
        }
      }

      paper-button iron-icon {
        margin-bottom: 10px;
      }

      .card-badge {
        font-weight: normal;
        border-radius: 10px;
        width: 20px;
        height: 20px;
        text-align: center;
        background-color: var(--cart-badge-color, --accent-color);
        color: var(--cart-badge-text-color, --primary-text-color);
        @apply(--cart-badge);
      }

      .menu-button iron-icon {
        width: 20px;
        height: 20px;
        @apply(--menu-button-icon);
      }

      .menu-button .span {
        @apply(--menu-button-text);
      }

      .cart-button {
        position: relative;
      }

      .cart-button> ul {
        display: none;
        z-index: 2;
        width: 500px;
        max-height: 355px;
        padding: 0 0 0 0;
        margin-top: 0;
        background-color: white;
        position: absolute;
        right: 0;
        box-shadow: 0px 5px 6px -3px rgba(0, 0, 0, 0.4);
      }

      .cart-button:hover {
        background-color: var(--cart-button-hover-color, --dark-primary-color);
      }

      .cart-button:hover> ul {
        display: block;
        color: var(--menu-item-hover-text-color, black);
        background: var(--dropdown-background-color, white);
      }

      .cart-button> ul:hover {
        display: block;
      }

      .items-container {
        max-height: 240px;
        overflow: auto;
      }

      .cart-product {
        height: 50px;
        padding: 10px;
        font-size: 16px;
      }

      .cart-product:not(:last-of-type) {
        border-bottom: 1px solid #c7c7c7;
      }

      .cart-product:hover {
        background-color: #F7F7F7;
        cursor: pointer;
      }

      .cart-product .image {
        height: 50px;
        width: 30px;
        margin-right: 10px;
        @apply(--cart-product-image);
      }

      .cart-product .name {
        font-weight: bold;
        ;
        color: var(--product-name-text-color, --primary-text-color);
        @apply(--cart-product-name);
      }

      .cart-product .quantity {
        font-weight: bold;
        text-align: center;
        color: var(--product-quantity-text-color, --default-primary-color);
        @apply(--cart-product-quantity);
      }

      .cart-product .price {
        font-weight: bolder;
        color: var(--product-price-text-color, --default-primary-color);
        @apply(--cart-product-price);
      }

      .show-all-message {
        font-size: 18px;
        color: var(--checkout-message-color, --default-secondary-color);
        cursor: pointer;
        text-align: center;
        border-bottom: 1px solid red;
        border-top: 1px solid red;
        padding: 10px;
      }

      .cart-actions {
        padding: 20px;
      }

      .primary-button {
        padding: 20px;
        color: white;
        cursor: pointer;
        font-weight: bold;
        margin-left: 20px;
        border: 1px solid #bfbfbf;
        text-align: center;
        background-color: var(--checkout-button-background-color, --default-secondary-color);
      }

      .primary-button:hover {
        color: white;
        background-color: var(--checkout-button-background-color-hover, --dark-secondary-color);
      }

      .secondary-button {
        padding: 15px;
        height: 15px;
        color: white;
        cursor: pointer;
        font-weight: bold;
        border: 1px solid #bfbfbf;
        text-align: center;
        color: var(--secondary-button-color, --default-primary-color);
        background-color: var(--checkout-button-background-color, white);
      }

      .secondary-button:hover {
        background-color: #F7F7F7;
      }

      paper-toast#addItemToast {
        background-color: white;
        color: black;
        width: 400px;
        margin-right: 20px;
      }

      .toast-header{
        font-size: 18px;
        margin-bottom: 10px;
      }
    </style>

    <div class="cart-button">
      <a href="[[cartUrl]]">
        <paper-button class="menu-button layout vertical center"
            style="margin:0">
          <div class="layout horizontal center-justified">
            <iron-icon icon="shopping-cart"></iron-icon>
            <div class="layout horizontal center-justified card-badge">
              <span class="layout self-center">[[cartItems.length]]</span>
            </div>
          </div>
          <span>[[cartMessage]]</span>
        </paper-button>
      </a>
      <ul>
        <div class="items-container">
          <template is="dom-repeat"
              items="[[_cartItems]]"
              index-as="index">
            <div class="layout horizontal center cart-product">
              <iron-image class="image flex"
                  src="[[item.image]]"
                  preload
                  sizing="contain"></iron-image>
              <span class="name flex">[[item.name]]</span>
              <span class="quantity flex">[[item.quantity]]</span>
              <span class="price flex">[[_formatPrice(item.price)]]</span>
              <paper-icon-button icon="clear"></paper-icon-button>
            </div>
          </template>
        </div>
        <div class="show-all-message">
          Ver todos os [[cartItems.length]] items
        </div>
        <div class="layout horizontal center end-justified cart-actions">
          <a class="secondary-button"
              href="[[cartUrl]]">
            [[seeCartMessage]]
          </a>
          <a class="primary-button"
              href="[[checkoutUrl]]">
            [[checkoutMessage]]
          </a>
        </div>
      </ul>
    </div>
    <paper-toast id="addItemToast"
        vertical-align="top"
        horizontal-align="right">
      <div class="layout vertical">
        <span class="self-center toast-header">[[addItemToastMessage]]</span>
        <div class="layout horizontal">
          <a class="secondary-button layout flex"
              href="[[cartUrl]]">
          [[seeCartMessage]]
        </a>
          <a class="primary-button layout flex" style="margin-left:5px; padding:15px;height:15px;"
              href="[[checkoutUrl]]">
        [[checkoutMessage]]
      </a>
        </div>
      </div>
    </paper-toast>

  </template>

  <script>
    Polymer({
      is: 'acre-cart-presenter',

      properties: {

        /**
         * The cart url
         */
        cartUrl: {
          type: String,
          value: '',
        },

        /**
         * The cart message
         */
        cartMessage: {
          type: String,
          value: "Meu Carrinho"
        },

        checkoutMessage: {
          type: String,
          value: "FINALIZAR COMPRA"
        },

        seeCartMessage: {
          type: String,
          value: "VER CARRINHO"
        },

        addItemToastMessage: {
          type: String,
          value: 'Produto adicionado ao carrinho'
        },

        cartItems: {
          type: Object,
          value: function() {
            return [{
              id: 1,
              image: 'http://sm.metheora.com/Pictures/d49432b0-47e1-492d-a77e-33dd13cd407a.jpg',
              name: 'Produto 1',
              price: 222,
              quantity: 1
            }, {
              id: 2,
              image: 'http://www.shoppingmatriz.com.br/img/cadeirasrhodes/ipanema_president_relax%20mil.jpg',
              name: 'Produto 2',
              price: 222,
              quantity: 1
            }, {
              id: 3,
              image: 'http://www.shoppingmatriz.com.br/img/cadeirasrhodes/ipanema_president_relax%20mil.jpg',
              name: 'Produto 3',
              price: 222,
              quantity: 1
            }, {
              id: 4,
              image: 'http://sm.metheora.com/Pictures/d49432b0-47e1-492d-a77e-33dd13cd407a.jpg',
              name: 'Produto 4',
              price: 222,
              quantity: 1
            }, {
              id: 5,
              image: '',
              name: 'Produto 5',
              price: 222,
              quantity: 1
            }]
          }
        },

        _cartItems: {
          type: String,
          computed: '_cartItemsVisible(cartItems)'
        },
      },

      // computed
      _cartItemsVisible: function(items) {
        return items.slice(0, 3);
      },

      // Element Lifecycle

      ready: function() {
        // `ready` is called after all elements have been configured, but
        // propagates bottom-up. This element's children are ready, but parents
        // are not.
        //
        // This is the point where you should make modifications to the DOM (when
        // necessary), or kick off any processes the element wants to perform.
      },

      attached: function() {
        // `attached` fires once the element and its parents have been inserted
        // into a document.
        //
        // This is a good place to perform any work related to your element's
        // visual state or active behavior (measuring sizes, beginning animations,
        // loading resources, etc).
      },

      detached: function() {
        // The analog to `attached`, `detached` fires when the element has been
        // removed from a document.
        //
        // Use this to clean up anything you did in `attached`.
      },

      // Element Behavior


      // functions

      addItem: function(item) {
        this.$.addItemToast.open();
      },

      //utils
      _formatPrice: function(price) {
        if (!price) return price;
        return "R$ " + price.toFixed(2);
      },

    });
  </script>
</dom-module>
